# Web3 CDK - ã‚·ãƒ³ãƒ—ãƒ«ã§åŠ¹çŽ‡çš„ãªCDKãƒ„ãƒ¼ãƒ«ç¾¤

AWS CDKã‚’ã‚·ãƒ³ãƒ—ãƒ«ã‹ã¤åŠ¹çŽ‡çš„ã«ç«‹ã¡ä¸Šã’ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ç¾¤ã§ã™ã€‚

## ðŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®å®Ÿè¡Œ
npm run setup
```

### 2. ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—
```bash
# CDKãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—
npm run bootstrap
```

### 3. ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
# é–‹ç™ºç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy:dev

# ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy:stg

# æœ¬ç•ªç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy:prod
```

## ðŸ“‹ å¿…è¦ãªç’°å¢ƒå¤‰æ•°ï¼ˆãŸã£ãŸ3ã¤ï¼ï¼‰

| å¤‰æ•°å | èª¬æ˜Ž | ä¾‹ |
|--------|------|-----|
| CDK_ACCOUNT | AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆID | 123456789012 |
| CDK_REGION | ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ | ap-northeast-1 |
| CDK_ENV | ç’°å¢ƒå | dev, stg, prod |

## ðŸ› ï¸ åˆ©ç”¨å¯èƒ½ãªã‚³ãƒžãƒ³ãƒ‰

```bash
npm run setup         # åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
npm run bootstrap     # CDKãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—
npm run list          # ã‚¹ã‚¿ãƒƒã‚¯ä¸€è¦§è¡¨ç¤º
npm run build         # TypeScriptã®ãƒ“ãƒ«ãƒ‰
npm run test          # ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
npm run diff:dev      # é–‹ç™ºç’°å¢ƒã®å·®åˆ†ç¢ºèª
npm run diff:stg      # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã®å·®åˆ†ç¢ºèª
npm run diff:prod     # æœ¬ç•ªç’°å¢ƒã®å·®åˆ†ç¢ºèª
npm run deploy:dev    # é–‹ç™ºç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy:stg    # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy:prod   # æœ¬ç•ªç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤
npm run destroy:dev   # é–‹ç™ºç’°å¢ƒã®ã‚¹ã‚¿ãƒƒã‚¯å‰Šé™¤
npm run destroy:stg   # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã®ã‚¹ã‚¿ãƒƒã‚¯å‰Šé™¤
npm run destroy:prod  # æœ¬ç•ªç’°å¢ƒã®ã‚¹ã‚¿ãƒƒã‚¯å‰Šé™¤
npm run research      # å­¤ç«‹ã‚¹ã‚¿ãƒƒã‚¯èª¿æŸ»ãƒ„ãƒ¼ãƒ«
```

## ðŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
web3cdk/
â”œâ”€â”€ ðŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†
â”‚   â”œâ”€â”€ package.json          # Node.jsè¨­å®š
â”‚   â”œâ”€â”€ README.md            # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜Ž  
â”‚   â””â”€â”€ LICENSE              # ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
â”‚
â”œâ”€â”€ ðŸ“ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â””â”€â”€ src/                 # ãƒ¡ã‚¤ãƒ³ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚       â”œâ”€â”€ bin/            # CDKã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚       â””â”€â”€ lib/            # CDKã‚¹ã‚¿ãƒƒã‚¯å®šç¾©
â”‚
â”œâ”€â”€ ðŸ“ é–‹ç™ºãƒ»é‹ç”¨
â”‚   â”œâ”€â”€ scripts/            # ç®¡ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”‚   â”œâ”€â”€ setup.sh        # åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”‚   â”‚   â”œâ”€â”€ bootstrap.sh    # CDKãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—
â”‚   â”‚   â”œâ”€â”€ list-stacks.sh  # ã‚¹ã‚¿ãƒƒã‚¯ä¸€è¦§è¡¨ç¤º
â”‚   â”‚   â”œâ”€â”€ diff.sh         # å·®åˆ†ç¢ºèª
â”‚   â”‚   â”œâ”€â”€ deploy.sh       # ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ destroy.sh      # ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤
â”‚   â”‚   â””â”€â”€ investigate-stack.sh # å­¤ç«‹ã‚¹ã‚¿ãƒƒã‚¯èª¿æŸ»
â”‚   â”œâ”€â”€ test/              # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ docs/              # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚
â””â”€â”€ ðŸ“ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
    â”œâ”€â”€ config/             # ç’°å¢ƒãƒ»CDKè¨­å®š
    â”‚   â”œâ”€â”€ environments/   # ç’°å¢ƒåˆ¥è¨­å®š
    â”‚   â”œâ”€â”€ cdk.json        # CDKè¨­å®š
    â”‚   â””â”€â”€ .env.*          # ç’°å¢ƒå¤‰æ•°
    â””â”€â”€ tools/              # é–‹ç™ºãƒ„ãƒ¼ãƒ«è¨­å®š
        â”œâ”€â”€ tsconfig.json   # TypeScriptè¨­å®š
        â”œâ”€â”€ jest.config.js  # ãƒ†ã‚¹ãƒˆè¨­å®š
        â””â”€â”€ *.code-workspace # ã‚¨ãƒ‡ã‚£ã‚¿è¨­å®š
```

## ðŸ”„ é–‹ç™ºãƒ•ãƒ­ãƒ¼ï¼ˆåˆå­¦è€…å‘ã‘ï¼‰

1. **åˆå›žã®ã¿**: `npm run setup`ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
2. **åˆå›žã®ã¿**: `npm run bootstrap`ã§CDKãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—
3. **é–‹ç™º**: ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£
4. **ãƒ†ã‚¹ãƒˆ**: `npm run test`ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
5. **å·®åˆ†ç¢ºèª**: `npm run diff:dev`ã§å¤‰æ›´ç‚¹ã‚’ç¢ºèª
6. **ãƒ‡ãƒ—ãƒ­ã‚¤**: `npm run deploy:dev`ã§ãƒ‡ãƒ—ãƒ­ã‚¤
7. **ç¢ºèª**: AWS Consoleã§ç¢ºèª

### ðŸ’¡ ä¸Šç´šè€…å‘ã‘Tips

è¤‡æ•°ã‚¹ã‚¿ãƒƒã‚¯ãŒã‚ã‚‹å ´åˆã¯ã€CDKã®æ¨™æº–ã‚³ãƒžãƒ³ãƒ‰ã§å€‹åˆ¥åˆ¶å¾¡ã‚‚å¯èƒ½ï¼š

```bash
# ç‰¹å®šã‚¹ã‚¿ãƒƒã‚¯ã®ã¿æ“ä½œ
npx cdk deploy my-api-stack      # APIã‚¹ã‚¿ãƒƒã‚¯ã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤
npx cdk diff my-web-stack        # Webã‚¹ã‚¿ãƒƒã‚¯ã®å·®åˆ†ç¢ºèª
npx cdk destroy my-db-stack      # DBã‚¹ã‚¿ãƒƒã‚¯ã®ã¿å‰Šé™¤

# å…¨ä½“æ“ä½œ
npx cdk deploy --all             # å…¨ã‚¹ã‚¿ãƒƒã‚¯ä¸€æ‹¬ãƒ‡ãƒ—ãƒ­ã‚¤
npx cdk diff --all               # å…¨ã‚¹ã‚¿ãƒƒã‚¯å·®åˆ†ç¢ºèª
npx cdk ls                       # ã‚¹ã‚¿ãƒƒã‚¯ä¸€è¦§è¡¨ç¤º
```

**åˆå­¦è€…ã®æ–¹**: ã¾ãšã¯ `npm run` ã‚³ãƒžãƒ³ãƒ‰ã‹ã‚‰å§‹ã‚ã¦ã€æ…£ã‚Œã¦ããŸã‚‰ `npx cdk` ã‚³ãƒžãƒ³ãƒ‰ã‚‚è©¦ã—ã¦ã¿ã¦ãã ã•ã„ï¼

## ðŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å­¤ç«‹ã‚¹ã‚¿ãƒƒã‚¯ã®èª¿æŸ»ãƒ»å‰Šé™¤

CDKãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã‚’å‰Šé™¤ã—ãŸå¾Œã«æ®‹ã£ã¦ã—ã¾ã£ãŸã‚¹ã‚¿ãƒƒã‚¯ãŒã‚ã‚‹å ´åˆï¼š

```bash
# ä¾‹: MyProdStackã‚’èª¿æŸ»ã™ã‚‹å ´åˆ
# 1. ç’°å¢ƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cat > .env.myprod << EOF
CDK_ACCOUNT=123456789012
CDK_REGION=ap-northeast-1
STACK_NAME=MyProdStack
EOF

# 2. èª¿æŸ»ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œ
npm run research myprod
```

ã“ã®ãƒ„ãƒ¼ãƒ«ã§ã¯ä»¥ä¸‹ã®æ“ä½œãŒå¯èƒ½ã§ã™ï¼š
- ã‚¹ã‚¿ãƒƒã‚¯è©³ç´°è¡¨ç¤º
- ãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§è¡¨ç¤º
- ã‚¹ã‚¿ãƒƒã‚¯å‰Šé™¤ï¼ˆCDKå®Ÿè¡Œãƒ­ãƒ¼ãƒ«ãŒå‰Šé™¤ã•ã‚Œã¦ã„ã¦ã‚‚å¯¾å¿œï¼‰

**æ³¨æ„**: CDKãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—å‰Šé™¤å¾Œã¯é€šå¸¸ã®å‰Šé™¤ãŒã§ããªã„ãŸã‚ã€ç‰¹åˆ¥ãªæ‰‹é †ãŒå¿…è¦ã§ã™ã€‚ãƒ„ãƒ¼ãƒ«ãŒè§£æ±ºç­–ã‚’æç¤ºã—ã¾ã™ã€‚

## ðŸ“– è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­è¨ˆæ›¸](docs/project-design.md)
- [CDK Bootstrap ã‚¬ã‚¤ãƒ‰](docs/cdk-bootstrap-guide.md)

## âš¡ ç‰¹å¾´

- **ã‚·ãƒ³ãƒ—ãƒ«**: ç’°å¢ƒå¤‰æ•°ã¯3ã¤ã ã‘
- **å®‰å…¨**: æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ç¢ºèªä»˜ã
- **åŠ¹çŽ‡çš„**: 1ã‚³ãƒžãƒ³ãƒ‰ã§ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†
- **æ‹¡å¼µå¯èƒ½**: æ®µéšŽçš„ã«æ©Ÿèƒ½è¿½åŠ å¯èƒ½

## ðŸ¤ è²¢çŒ®

Issue ã‚„ Pull Request ã¯å¤§æ­“è¿Žã§ã™ï¼

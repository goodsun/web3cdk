# Claude Code Configuration

## (重要)プロジェクトの目的
ベストプラクティスな方法でcdkを効率的に立ち上げるツール郡を構築したい。
シンプルで確実な方法で一歩一歩進める。


### 🎯 設計思想：初学者と上級者のバランス

#### 基本方針：「初学者ファースト、上級者配慮」
- **プロジェクト構成**: ルートディレクトリはすっきり、役割別のディレクトリ分け
- **メイン機能**: 初学者が迷わないシンプルなコマンド
- **拡張機能**: 上級者向けはTipsやコラムとして紹介
- **学習段階**: 段階的にスキルアップできる設計

#### コマンド設計の考え方
```
🎓 初学者向け（メイン）:
  npm run deploy:dev    # 簡単！分かりやすい！
  npm run diff:prod     # 何をするか一目瞭然！

🚀 上級者向け（Tips）:
  npx cdk deploy stack-name    # 柔軟性重視
  npx cdk diff --all          # 詳細制御
```

#### ドキュメント構成の原則
1. **メインフロー**: 初学者向けの手順を分かりやすく
2. **上級者Tips**: 「💡 上級者向けTips」として分離
3. **学習の橋渡し**: 「慣れてきたら〜も試してみてください」で案内

#### 設計のメリット
1. **学習コスト削減**: 新しい開発者が迷わない
2. **保守性向上**: ファイルの配置が論理的  
3. **拡張性確保**: 新しいファイルの置き場所が明確
4. **成功体験**: 初学者も上級者も制限を感じない

## 🌱 継続的開発における健全性の原則

### 🏗️ 基本理念
**「最初の数時間が将来を決める」**
- 構造的健全性がシステム信頼性の基盤
- ドキュメント正確性も含む総合的健全性
- クリーンな構造の自己強化サイクル効果

### 📋 健全性の3つの柱

#### 🔒 1. 構造的健全性
- **機密管理**: 専用ディレクトリに隔離、Git管理の選択的適用
- **ディレクトリ構造**: 目的別分類、論理的階層、拡張性確保
- **重複排除**: 同じ目的のディレクトリは作らない

#### 📚 2. ドキュメント正確性
- **実装との同期**: コード変更時にドキュメントも必ず更新
- **テスト可能な手順書**: 記載コマンドは実際に動作確認済み
- **完全な索引維持**: 全ドキュメントにアクセス可能な目次

#### 🔄 3. 継続的クリーン化
- **新しいファイルは既存カテゴリに配置**
- **目的が不明なファイルは作らない**
- **定期的な構造見直し**
- **即座修正**: 発見した問題は最優先で修正

### ⚠️ 絶対に避けるべき構造的問題

#### 🚫 構造の乱れパターン
- ルートディレクトリへの無秩序なファイル配置
- 機密情報の不適切な管理
- 目的不明なディレクトリの乱立
- ドキュメントの散乱と索引の欠如

#### 🚫 技術的負債の温床
- 重複コードや設定ファイルの放置
- 役割不明なファイルの蓄積
- 古い設定や使われなくなったファイルの残存
- 一貫性のない命名規則

### 💡 健全性を保つ実践的アプローチ

#### 日常的な判断基準
1. **このファイルの置き場所は明確か？**
2. **3ヶ月後の自分が迷わないか？**
3. **新しいチームメンバーが理解できるか？**
4. **機密情報の扱いは適切か？**

#### 作業時の確認事項
- 新規ファイル作成時: 適切なカテゴリへの配置
- ドキュメント追加時: 索引の更新
- 機能追加時: 重複の有無確認
- 定期的: 不要ファイルの削除

**重要**: この健全性の原則は、開発速度と品質の両方を支える基盤である。技術的な実装よりも優先して守るべき原則として位置づける。

### 📊 定期的な健全性チェック

#### チェック項目
- [ ] README.mdのプロジェクト構成と実際のディレクトリが一致
- [ ] docs/guides/の手順書を実際に実行して動作確認
- [ ] docs/design/specification.mdの仕様と実装が一致
- [ ] backup/README.mdの運用手順が実際の運用と一致
- [ ] 環境変数の説明と実際の.envファイルが一致
- [ ] SSL証明書の有効期限等の時間依存情報が最新

#### 実施タイミング
- 重要な機能追加後
- 月次の定期チェック
- 新しいチームメンバー参加時
- 本番環境デプロイ前

## 📊 進捗管理

### プロジェクトの進捗状況
- **進捗管理ファイル**: `docs/planning/milestones.md`
- **現在のステータス**: Stage 3完了、Stage 4進行中（60%）

### Claude Codeの進捗管理ルール
1. **作業完了時**: milestones.mdを必ず更新する
2. **進捗確認時**: milestones.mdの情報を参照して回答する
3. **新機能追加時**: 該当するStageの項目を更新する
4. **定期更新**: 大きな変更があった場合は更新履歴に記載する

### 進捗報告の基準
- ユーザーから進捗を聞かれたら、milestones.mdの内容を基に具体的に回答
- パーセンテージや完了項目数を含めて定量的に報告
- 次のアクションアイテムも併せて提示

## 🎯 Development Mode Settings

**現在高速モード** 
<!-- 現在高速モード / 現在慎重モード のどちらかを記載 -->

### モード切り替え方法
```
# 高速モードに切り替え
"高速モードに切り替えて"

# 慎重モードに切り替え  
"慎重モードに切り替えて"
```

**モード切り替え時は、Claude が CLAUDE.md の「現在○○モード」部分を自動更新します**

### 🚀 高速モード (Fast Development Mode)
- ソースコード変更を確認なしで実行
- アイデアを素早く形にすることを優先
- 複数の修正を連続して適用
- エラーが出たら修正して継続

### 🔍 慎重モード (Careful Development Mode)  
- ソースコード変更前に毎回確認を求める
- 一つずつ丁寧に変更内容を説明
- ユーザーの承認後に変更を実行
- 重要な修正や本番環境では必須

### Claude Code 標準の確認動作

#### 📋 DRY原則の厳守 (Don't Repeat Yourself)
- **重複コードの排除**: 同じロジックは関数・クラス・モジュールとして切り出す
- **設定の一元化**: 定数・設定値は一箇所で管理し、複数箇所で参照
- **共通処理の抽象化**: 似たような処理は共通関数として実装
- **コピー&ペーストの禁止**: 既存コードをコピーする前に共通化を検討
- **リファクタリングの推奨**: 重複が発見された場合は積極的に統合

#### 🔒 常に確認が必要な操作（モードに関係なく）
- **危険なコマンド**: `rm -rf`, `sudo`, `chmod +x` など
- **Git操作**: `git push`, `git reset --hard`, `git clean -fd`
- **パッケージインストール**: `npm install`, `pip install` 
- **環境変数の変更**: `.env` ファイルの編集
- **データベース操作**: DROP, DELETE, TRUNCATE など
- **ファイル削除**: 既存ファイルの削除

#### ⚡ 高速モードで確認をスキップする操作
- **ファイル作成・編集**: 新規ファイル作成、既存ファイルの修正
- **TypeScript/JavaScript**: コード追加・修正
- **設定ファイル**: package.json, tsconfig.json の更新
- **ドキュメント**: README, CLAUDE.md の更新
- **開発用コマンド**: `npm run build`, `npm test`
- **ローカルデプロイ**: `./deploy.sh local` （Discord機能以外）
- **Discord本番デプロイ**: `./deploy.sh production` （Discord機能専用）

#### 🔍 慎重モードで追加確認する操作
- **全てのファイル編集**: 内容を説明してから実行
- **コマンド実行**: 実行内容を説明してから実行
- **複数ファイル一括変更**: 影響範囲を説明してから実行
- **API仕様変更**: 破壊的変更の可能性を説明

#### 📋 確認メッセージの例
```
慎重モード時:
「app.ts に Discord EOA 機能を追加します。
 - 新しいエンドポイント /discord/member/:userId を追加
 - DynamoDB から EOA 情報を取得する処理を追加
実行してよろしいですか？」

高速モード時:
（確認なしで即座に実行）
```

## ⚠️ 重要な教訓

### 🚨 ユーザーの指示を必ず従う
- **ユーザーが「まずは〇〇」と言ったら、必ずその順序で実行する**
- **「シンプルで確実な方法で一歩一歩」と言われたら、複雑化しない**
- **勝手に機能を追加したり、指示を無視してはいけない**

### 📝 失敗例
```
ユーザー: 「まずはbootstrap」
Claude: setup.sh に bootstrap を混ぜ込んだ（間違い）

正解: bootstrap を単独で実行し、その後で setup を分離する
```

### ✅ 正しいアプローチ
1. **指示を正確に理解する**
2. **余計な機能を追加しない**
3. **確認してから進める**
4. **シンプルを保つ**

# Claude Code Configuration

## (重要)プロジェクトの目的
ベストプラクティスな方法でcdkを効率的に立ち上げるツール郡を構築したい。
シンプルで確実な方法で一歩一歩進める。

### 🎯 プロジェクト構成の設計思想

#### 初学者フレンドリーな構成
- **ルートディレクトリはすっきり**: 重要なファイル（package.json、README.md）のみ
- **役割別のディレクトリ分け**: 何がどこにあるか一目で分かる
- **設定ファイルの集約**: 散らばりがちな設定ファイルを整理

#### ディレクトリ構成の原則
```
web3cdk/
├── 📋 プロジェクト管理 (ルート)
├── 📁 ソースコード (src/)
├── 📁 開発・運用 (scripts/, test/, docs/)
└── 📁 設定ファイル (config/, tools/)
```

#### 設計のメリット
1. **学習コスト削減**: 新しい開発者が迷わない
2. **保守性向上**: ファイルの配置が論理的
3. **拡張性**: 新しいファイルの置き場所が明確
4. **プロフェッショナル**: 整理された印象を与える

### 🎯 初学者と上級者のバランス設計思想

#### 基本方針：「初学者ファースト、上級者配慮」
- **メイン機能**: 初学者が迷わないシンプルなコマンド
- **拡張機能**: 上級者向けはTipsやコラムとして紹介
- **学習段階**: 段階的にスキルアップできる設計

#### コマンド設計の考え方
```
🎓 初学者向け（メイン）:
  npm run deploy:dev    # 簡単！分かりやすい！
  npm run diff:prod     # 何をするか一目瞭然！

🚀 上級者向け（Tips）:
  npx cdk deploy stack-name    # 柔軟性重視
  npx cdk diff --all          # 詳細制御
```

#### ドキュメント構成の原則
1. **メインフロー**: 初学者向けの手順を分かりやすく
2. **上級者Tips**: 「💡 上級者向けTips」として分離
3. **学習の橋渡し**: 「慣れてきたら〜も試してみてください」で案内

#### この設計により実現すること
- **初学者**: 迷わず使える、成功体験を得られる
- **上級者**: 必要な情報は得られる、制限を感じない
- **プロジェクト**: シンプルさを保ちつつ、拡張性も確保

## 🌱 継続的開発における健全性の原則

### 🏗️ 健全なシステム = 健全な構造

**基本理念**: 「最初の数時間が将来を決める」

#### 構造的健全性の重要性
- **雑な構造で始めると、後から直すのは10倍大変**
- **最初からクリーンだと、自然とクリーンが保たれる**
- **技術的負債は構造の乱れから始まる**
- **継続開発における複利効果を最大化する**

#### クリーンな構造の自己強化サイクル
```
クリーンな構造 → 作業効率UP → 時間に余裕 → さらに改善 → より良い構造
```

### 📋 構造的健全性の厳守原則

#### 🔒 機密管理の原則
- **機密情報は必ず専用ディレクトリに隔離** (`backup/` など)
- **Git管理の選択的適用** (README.mdは管理、実データは除外)
- **適切な権限設定の徹底**
- **機密保管庫には必ず説明ドキュメントを配置**

#### 📁 ディレクトリ構造の原則
- **目的別の明確な分類**: 用途が一目で分かる命名
- **論理的な階層構造**: 深すぎず、浅すぎない適切な深度
- **拡張性の確保**: 将来の追加要素を考慮した設計
- **重複の排除**: 同じ目的のディレクトリは作らない

#### 📚 ドキュメント管理の原則
- **完全な索引の維持**: 全ドキュメントにアクセス可能な目次
- **目的別分類の徹底**: ガイド、設計書、開発リソース等の明確な分離
- **保守性の確保**: 新規追加時のルールを明文化
- **学習パスの提供**: 初学者〜上級者への段階的案内

#### 🔄 継続的クリーン化の原則
- **新しいファイルは既存カテゴリに配置**
- **目的が不明なファイルは作らない**
- **定期的な構造見直し**
- **クリーンさを保つ作業を最優先事項とする**

### ⚠️ 絶対に避けるべき構造的問題

#### 🚫 構造の乱れパターン
- ルートディレクトリへの無秩序なファイル配置
- 機密情報の不適切な管理
- 目的不明なディレクトリの乱立
- ドキュメントの散乱と索引の欠如

#### 🚫 技術的負債の温床
- 重複コードや設定ファイルの放置
- 役割不明なファイルの蓄積
- 古い設定や使われなくなったファイルの残存
- 一貫性のない命名規則

### 💡 健全性を保つ実践的アプローチ

#### 日常的な判断基準
1. **このファイルの置き場所は明確か？**
2. **3ヶ月後の自分が迷わないか？**
3. **新しいチームメンバーが理解できるか？**
4. **機密情報の扱いは適切か？**

#### 作業時の確認事項
- 新規ファイル作成時: 適切なカテゴリへの配置
- ドキュメント追加時: 索引の更新
- 機能追加時: 重複の有無確認
- 定期的: 不要ファイルの削除

**重要**: この健全性の原則は、開発速度と品質の両方を支える基盤である。技術的な実装よりも優先して守るべき原則として位置づける。

### 📖 ドキュメント正確性の原則

#### 「ドキュメント = ソースコード」の同等性
**基本理念**: ドキュメントの正確性はシステムの信頼性に直結する

- **docs/の内容とsrc/の実装は同じ重要度**
- **特定のコミット時点で実装と説明が完全一致している状態が理想**
- **手順書通りに実行すれば必ず動作する状態を保つ**

#### 正確性が特に重要なドキュメント
- `docs/design/specification.md` ← 実装仕様と完全一致必須
- `docs/guides/` ← 実際に動く手順書である必要
- `README.md`のプロジェクト構成 ← 実際のディレクトリ構造と一致
- `backup/README.md` ← 実際の運用手順と一致
- `CLAUDE.md` ← 開発原則と実際の作業方針が一致

#### ドキュメント同期の実践原則
1. **同時更新の徹底**: コード変更時にドキュメントも必ず更新
2. **テスト可能な手順書**: 記載されたコマンドは実際に動作確認済み
3. **検証可能な構成図**: ディレクトリ構成は実際の状態と一致
4. **期限のある情報**: SSL証明書期限等の時間依存情報は定期更新

#### 定期的なドキュメント整合性チェック
**「ドキュメント監査」の実施**

##### チェック項目
- [ ] README.mdのプロジェクト構成と実際のディレクトリが一致
- [ ] docs/guides/の手順書を実際に実行して動作確認
- [ ] docs/design/specification.mdの仕様と実装が一致
- [ ] backup/README.mdの運用手順が実際の運用と一致
- [ ] 環境変数の説明と実際の.envファイルが一致
- [ ] SSL証明書の有効期限等の時間依存情報が最新

##### 実施タイミング
- **重要な機能追加後**
- **月次の定期チェック**
- **新しいチームメンバー参加時**
- **本番環境デプロイ前**

##### クリーンシステムの利点
- **構造が整理されているため、チェック対象が明確**
- **ドキュメントが分類されているため、確認作業が効率的**
- **機密情報が分離されているため、安全に検証可能**
- **索引が完備されているため、漏れのない確認が可能**

#### 乖離発見時の対応原則
1. **即座に修正**: 発見した乖離は最優先で修正
2. **根本原因の分析**: なぜ乖離が発生したかを検証
3. **予防策の実装**: 同じ乖離が再発しないような仕組みづくり
4. **チェック項目の追加**: 発見した乖離をチェックリストに追加

**重要**: ドキュメントの不正確性は、技術的バグと同じくらい深刻な問題として扱う。

## 📊 進捗管理

### プロジェクトの進捗状況
- **進捗管理ファイル**: `docs/planning/milestones.md`
- **現在のステータス**: Stage 3完了、Stage 4進行中（60%）

### Claude Codeの進捗管理ルール
1. **作業完了時**: milestones.mdを必ず更新する
2. **進捗確認時**: milestones.mdの情報を参照して回答する
3. **新機能追加時**: 該当するStageの項目を更新する
4. **定期更新**: 大きな変更があった場合は更新履歴に記載する

### 進捗報告の基準
- ユーザーから進捗を聞かれたら、milestones.mdの内容を基に具体的に回答
- パーセンテージや完了項目数を含めて定量的に報告
- 次のアクションアイテムも併せて提示

## 🎯 Development Mode Settings

**現在高速モード** 
<!-- 現在高速モード / 現在慎重モード のどちらかを記載 -->

### モード切り替え方法
```
# 高速モードに切り替え
"高速モードに切り替えて"

# 慎重モードに切り替え  
"慎重モードに切り替えて"
```

**モード切り替え時は、Claude が CLAUDE.md の「現在○○モード」部分を自動更新します**

### 🚀 高速モード (Fast Development Mode)
- ソースコード変更を確認なしで実行
- アイデアを素早く形にすることを優先
- 複数の修正を連続して適用
- エラーが出たら修正して継続

### 🔍 慎重モード (Careful Development Mode)  
- ソースコード変更前に毎回確認を求める
- 一つずつ丁寧に変更内容を説明
- ユーザーの承認後に変更を実行
- 重要な修正や本番環境では必須

### Claude Code 標準の確認動作

#### 📋 DRY原則の厳守 (Don't Repeat Yourself)
- **重複コードの排除**: 同じロジックは関数・クラス・モジュールとして切り出す
- **設定の一元化**: 定数・設定値は一箇所で管理し、複数箇所で参照
- **共通処理の抽象化**: 似たような処理は共通関数として実装
- **コピー&ペーストの禁止**: 既存コードをコピーする前に共通化を検討
- **リファクタリングの推奨**: 重複が発見された場合は積極的に統合

#### 🔒 常に確認が必要な操作（モードに関係なく）
- **危険なコマンド**: `rm -rf`, `sudo`, `chmod +x` など
- **Git操作**: `git push`, `git reset --hard`, `git clean -fd`
- **パッケージインストール**: `npm install`, `pip install` 
- **環境変数の変更**: `.env` ファイルの編集
- **データベース操作**: DROP, DELETE, TRUNCATE など
- **ファイル削除**: 既存ファイルの削除

#### ⚡ 高速モードで確認をスキップする操作
- **ファイル作成・編集**: 新規ファイル作成、既存ファイルの修正
- **TypeScript/JavaScript**: コード追加・修正
- **設定ファイル**: package.json, tsconfig.json の更新
- **ドキュメント**: README, CLAUDE.md の更新
- **開発用コマンド**: `npm run build`, `npm test`
- **ローカルデプロイ**: `./deploy.sh local` （Discord機能以外）
- **Discord本番デプロイ**: `./deploy.sh production` （Discord機能専用）

#### 🔍 慎重モードで追加確認する操作
- **全てのファイル編集**: 内容を説明してから実行
- **コマンド実行**: 実行内容を説明してから実行
- **複数ファイル一括変更**: 影響範囲を説明してから実行
- **API仕様変更**: 破壊的変更の可能性を説明

#### 📋 確認メッセージの例
```
慎重モード時:
「app.ts に Discord EOA 機能を追加します。
 - 新しいエンドポイント /discord/member/:userId を追加
 - DynamoDB から EOA 情報を取得する処理を追加
実行してよろしいですか？」

高速モード時:
（確認なしで即座に実行）
```

## ⚠️ 重要な教訓

### 🚨 ユーザーの指示を必ず従う
- **ユーザーが「まずは〇〇」と言ったら、必ずその順序で実行する**
- **「シンプルで確実な方法で一歩一歩」と言われたら、複雑化しない**
- **勝手に機能を追加したり、指示を無視してはいけない**

### 📝 失敗例
```
ユーザー: 「まずはbootstrap」
Claude: setup.sh に bootstrap を混ぜ込んだ（間違い）

正解: bootstrap を単独で実行し、その後で setup を分離する
```

### ✅ 正しいアプローチ
1. **指示を正確に理解する**
2. **余計な機能を追加しない**
3. **確認してから進める**
4. **シンプルを保つ**
